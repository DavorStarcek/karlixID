@model KarlixID.Web.Models.ViewModels.EditRolesVM
@{
    ViewData["Title"] = "Uredi uloge";
}

<h2 class="mb-3">@ViewData["Title"]</h2>

<div class="mb-3">
    <strong>Korisnik:</strong> @Model.Email
    @if (!Model.EditorIsGlobalAdmin)
    {
        <span class="badge bg-secondary ms-2" title="Uređujete kao TenantAdmin">TenantAdmin editor</span>
    }
</div>

<form asp-action="EditRoles" method="post" class="card">
    <div class="card-body">
        <input type="hidden" asp-for="UserId" />

        <div class="row">
            @for (int i = 0; i < Model.Roles.Count; i++)
            {
                var r = Model.Roles[i];
                var id = $"Roles_{i}__Selected";
                <div class="col-md-4 mb-2">
                    <div class="form-check">
                        @* VARIJANTA 1: zaključano → disabled *@
                        @if (r.Locked)
                        {
                            <input class="form-check-input" id="@id"
                                   asp-for="Roles[i].Selected"
                                   disabled="disabled" />
                            <label class="form-check-label" for="@id">
                                @r.Name <span class="ms-1" title="Zaključano – ne možete mijenjati ovu ulogu">🔒</span>
                            </label>
                            <input type="hidden" asp-for="Roles[i].Name" />
                            @* disabled input se ne šalje → pošalji mirror vrijednost *@
                            <input type="hidden" name="Roles[@i].Selected" value="@(r.Selected ? "true" : "false")" />
                        }
                        else
                        {
                            @* VARIJANTA 2: slobodno *@
                            <input class="form-check-input" id="@id" asp-for="Roles[i].Selected" />
                            <label class="form-check-label" for="@id">@r.Name</label>
                            <input type="hidden" asp-for="Roles[i].Name" />
                        }
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="card-footer d-flex justify-content-between">
        <a asp-action="Index" class="btn btn-outline-secondary">Natrag</a>
        <button type="submit" class="btn btn-primary">Spremi</button>
    </div>
</form>
